<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verdant</title>
    <link rel="icon" href="https://ik.imagekit.io/7krb4a8ap/76deab65-6483-4a91-8645-48ba0a4d5e82-removebg-preview.png" sizes="144x144">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .iframe-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin-top: 2rem;
            margin-bottom: 2rem;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            flex-grow: 1;
            transition: height 0.5s ease-in-out, max-width 0.5s ease-in-out, margin 0.5s ease-in-out, border-radius 0.3s ease-in-out;
        }

        @media (min-width: 768px) {
            .iframe-container {
                height: calc(100vh - 6rem - 6rem - 5rem - 4rem - 2rem);
            }
        }

        body.proxy-active .main-title,
        body.proxy-active #personal-greeting,
        body.proxy-active .search-bar-container,
        body.proxy-active .footer-container {
            display: none;
        }

        body.proxy-active main {
            justify-content: flex-start;
            align-items: stretch;
            padding: 0;
        }

        body.proxy-active #control-bar {
            width: 100%;
            max-width: none;
            height: 3rem;
            padding: 0.5rem;
            transition: height 0.3s ease-in-out, border-radius 0.3s ease-in-out, width 0.3s ease-in-out, margin 0.3s ease-in-out;
            overflow: hidden;
            margin-top: 0;
            flex-shrink: 0;
            border-radius: 0;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            border-bottom-left-radius: 0.75rem;
            border-bottom-right-radius: 0.75rem;
            border-top-width: 1px;
            border-bottom-width: 1px;
        }

        body.proxy-active #control-bar.minimized {
            height: 2rem;
            border-radius: 0.75rem;
            width: fit-content;
            margin-left: auto;
            margin-right: 1rem;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            border-top-width: 1px;
            border-bottom-width: 1px;
        }

        body.proxy-active #control-bar.minimized #url-bar-input,
        body.proxy-active #control-bar.minimized #go-button {
            display: none;
        }

        body.proxy-active .iframe-container {
            flex-grow: 1;
            width: 100%;
            max-width: none;
            border-radius: 0;
            margin-top: 0;
            margin-bottom: 0;
            border-top-left-radius: 0.75rem;
            border-top-right-radius: 0.75rem;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            border-top-width: 1px;
            border-bottom-width: 0;
        }

        .iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            background-color: #000;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            border-radius: 0.75rem;
            flex-direction: column;
            gap: 1rem;
            z-index: 10;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #name-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        #name-modal-content {
            background-color: #1f2937;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            text-align: center;
            width: 90%;
            max-width: 400px;
            border: 1px solid #065f46;
        }

        #name-modal-content input {
            width: 100%;
            padding: 0.75rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            background-color: #374151;
            border: 1px solid #065f46;
            border-radius: 0.5rem;
            color: #d1d5db;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        #name-modal-content input:focus {
            border-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.5);
        }

        #name-modal-content button {
            background-color: #059669;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        #name-modal-content button:hover {
            background-color: #047857;
        }
    </style>
</head>
<body class="bg-neutral-900 text-neutral-200 min-h-screen flex flex-col">

    <header class="p-4 md:p-6 flex justify-between items-center border-b border-neutral-700">
        <a href="#" id="home-link" class="text-lg md:text-xl font-bold text-emerald-300 hover:text-emerald-400 transition-colors duration-200">
            Verdant
        </a>
        <nav>
            <ul class="flex space-x-4 md:space-x-8 text-neutral-300 text-sm md:text-base">
                <li><a href="games.html" class="hover:text-emerald-400 transition-colors duration-200">Games</a></li>
                <li><a href="apps.html" class="hover:text-emerald-400 transition-colors duration-200">Apps</a></li>
                <li><a href="movies.html" class="hover:text-emerald-400 transition-colors duration-200">Movies</a></li>
                <li><a href="ai.html" class="hover:text-emerald-400 transition-colors duration-200">AI Chat</a></li>
                <li><a href="settings.html" class="hover:text-emerald-400 transition-colors duration-200">Settings</a></li>
            </ul>
        </nav>
    </header>

    <main class="flex-grow flex flex-col items-center justify-center p-4">
        <h1 class="main-title text-4xl md:text-6xl font-bold text-emerald-200 mb-2 tracking-tighter text-center">
            Welcome to Verdant,
        </h1>
        <p id="personal-greeting" class="text-3xl md:text-5xl font-bold text-emerald-300 mb-8 tracking-tighter text-center"
           style="text-shadow: 0 0 8px rgba(52, 211, 153, 0.7);">
        </p>

        <div class="search-bar-container relative w-full max-w-md mb-8">
            <input
                type="text"
                id="search-input"
                placeholder="Enter a search query or URL"
                class="w-full py-3 pl-5 pr-12 bg-neutral-800 border border-emerald-600 rounded-lg text-neutral-100 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200"
            />
            <button class="absolute right-3 top-1/2 -translate-y-1/2 text-emerald-400 hover:text-emerald-300">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
            </button>
        </div>

        <div id="proxy-content-area" class="iframe-container hidden">
            <div id="loading-overlay" class="loading-overlay">
                <div class="spinner"></div>
                <p>Loading content via proxy...</p>
            </div>
        </div>

        <div id="control-bar" class="hidden w-full p-2 bg-neutral-800 border border-emerald-600 flex items-center justify-between gap-2 z-20">
            <button id="back-button" class="p-2 rounded-md hover:bg-neutral-700 text-emerald-400" title="Go Back">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
                </svg>
            </button>
            <button id="forward-button" class="p-2 rounded-md hover:bg-neutral-700 text-emerald-400" title="Go Forward">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                </svg>
            </button>
            <button id="refresh-button" class="p-2 rounded-md hover:bg-neutral-700 text-emerald-400" title="Refresh Page">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348A8.486 8.486 0 0 0 7.5 12c0 4.198 3.379 7.625 7.5 7.625S22.5 16.198 22.5 12a8.486 8.486 0 0 0-7.5-2.652m0 0-.94.313M15 12.75V15m-.484-1.25.023-.001C14.075 12.19 13.9 12 13.75 12h-.875c-.21 0-.414.12-.519.313M2.75 12.75h-.008A2.625 2.625 0 0 1 5.375 10.5m-1.25 1.5 2.5-2.5m1.5-2.5 2.5 2.5" />
                </svg>
            </button>
            <input type="text" id="url-bar-input" placeholder="Current URL" class="flex-grow py-1 px-3 bg-neutral-700 border border-emerald-600 rounded-md text-neutral-100 placeholder-neutral-400 focus:outline-none focus:ring-1 focus:ring-emerald-500" title="Current URL / Enter new URL">
            <button id="go-button" class="p-2 rounded-md bg-emerald-600 hover:bg-emerald-700 text-white" title="Go to URL">Go</button>
            <button id="minimize-button" class="p-2 rounded-md hover:bg-neutral-700 text-emerald-400" title="Minimize Control Bar">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
                </svg>
            </button>
        </div>
    </main>

    <footer class="footer-container p-4 md:p-6 flex justify-between items-center text-xs md:text-sm text-neutral-400 border-t border-neutral-700">
        <div class="flex items-center">
            &copy; 2025 Verdant
        </div>
        <div class="space-x-4 md:space-x-8">
            <a href="partners.html" class="hover:text-emerald-400 transition-colors duration-200">Partners</a>
            <a href="https://discord.gg/fwXJpGdBHd" class="hover:text-emerald-400 transition-colors duration-200">Discord</a>
            <a href="https://forms.gle/mnPMkYqdD2cxT5F49" class="hover:text-emerald-400 transition-colors duration-200">Feedback</a>
            <a href="https://github.com/Verdant-1/Verdant" class="hover:text-emerald-400 transition-colors duration-200">Github</a>
        </div>
    </footer>

    <div id="name-modal-overlay" style="display: none;">
        <div id="name-modal-content">
            <h2 class="text-xl font-bold text-emerald-200 mb-4">Welcome to Verdant!</h2>
            <p class="text-neutral-300 mb-4">What's your name?</p>
            <input type="text" id="name-input" placeholder="Enter your name" class="mb-4">
            <button id="save-name-button">Save Name</button>
        </div>
    </div>

    <script>
        // Helper function to update the personal greeting.
        function updatePersonalGreeting() {
            const userName = localStorage.getItem('userName');
            if (userName) {
                personalGreeting.textContent = `${userName}`;
                personalGreeting.classList.remove('hidden');
            } else {
                personalGreeting.textContent = '';
                personalGreeting.classList.add('hidden');
            }
        }

        // Resets the page to its initial state.
        function resetHomePage() {
            document.body.classList.remove('proxy-active');
            proxyContentArea.classList.add('hidden');
            controlBar.classList.add('hidden');
            searchInput.value = '';
            urlBarInput.value = '';
            
            mainTitle.style.display = '';
            searchBarContainer.style.display = '';
            footerContainer.style.display = '';
            updatePersonalGreeting();

            controlBar.classList.remove('minimized');
            minimizeButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
            </svg>`;
            minimizeButton.title = 'Minimize Control Bar';

            let existingIframe = proxyContentArea.querySelector('iframe');
            if (existingIframe) {
                existingIframe.remove();
            }
        }

        // Utility function to determine if a string is a valid URL.
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // Processes the URL for the iframe src.
        function processUrl(url) {
            if (!isValidUrl(url)) {
                return `https://www.google.com/search?q=${encodeURIComponent(url)}`;
            }
            // Add https:// if it's missing, but it's a valid URL format (e.g., 'example.com')
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                return `https://${url}`;
            }
            return url;
        }

        // New function to handle loading the URL into the iframe.
        function loadUrl(url) {
            if (!url) return;

            // Apply the new UI state.
            document.body.classList.add('proxy-active');
            mainTitle.style.display = 'none';
            personalGreeting.style.display = 'none';
            searchBarContainer.style.display = 'none';
            footerContainer.style.display = 'none';
            proxyContentArea.classList.remove('hidden');
            controlBar.classList.remove('hidden');

            // Remove any existing iframe to start fresh.
            let existingIframe = proxyContentArea.querySelector('iframe');
            if (existingIframe) {
                existingIframe.remove();
            }

            // Create and append the new iframe.
            const newIframe = document.createElement('iframe');
            newIframe.src = `/s/embed.html#${processUrl(url)}`;
            proxyContentArea.appendChild(newIframe);
            urlBarInput.value = url;

            // Reset control bar state.
            controlBar.classList.remove('minimized');
            minimizeButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
            </svg>`;
            minimizeButton.title = 'Minimize Control Bar';
        }

        const homeLink = document.getElementById('home-link');
        const searchInput = document.getElementById('search-input');
        const proxyContentArea = document.getElementById('proxy-content-area');
        const loadingOverlay = document.getElementById('loading-overlay');
        const mainTitle = document.querySelector('.main-title');
        const searchBarContainer = document.querySelector('.search-bar-container');
        const footerContainer = document.querySelector('.footer-container');
        const personalGreeting = document.getElementById('personal-greeting');
        
        const controlBar = document.getElementById('control-bar');
        const backButton = document.getElementById('back-button');
        const forwardButton = document.getElementById('forward-button');
        const refreshButton = document.getElementById('refresh-button');
        const urlBarInput = document.getElementById('url-bar-input');
        const goButton = document.getElementById('go-button');
        const minimizeButton = document.getElementById('minimize-button');

        const nameModalOverlay = document.getElementById('name-modal-overlay');
        const nameInput = document.getElementById('name-input');
        const saveNameButton = document.getElementById('save-name-button');

        // Event listener for the main search input.
        searchInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                loadUrl(searchInput.value.trim());
            }
        });

        homeLink.addEventListener('click', (event) => {
            event.preventDefault();
            resetHomePage();
        });

        backButton.addEventListener('click', () => {
            const currentIframe = proxyContentArea.querySelector('iframe');
            if (currentIframe && currentIframe.contentWindow) {
                currentIframe.contentWindow.history.back();
            }
        });

        forwardButton.addEventListener('click', () => {
            const currentIframe = proxyContentArea.querySelector('iframe');
            if (currentIframe && currentIframe.contentWindow) {
                currentIframe.contentWindow.history.forward();
            }
        });

        refreshButton.addEventListener('click', () => {
            const currentIframe = proxyContentArea.querySelector('iframe');
            if (currentIframe) {
                currentIframe.contentWindow.location.reload();
            }
        });

        // Event listener for the go button in the control bar.
        goButton.addEventListener('click', () => {
            loadUrl(urlBarInput.value.trim());
        });

        // Event listener for the URL bar input.
        urlBarInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                loadUrl(urlBarInput.value.trim());
            }
        });

        minimizeButton.addEventListener('click', () => {
            controlBar.classList.toggle('minimized');
            if (controlBar.classList.contains('minimized')) {
                minimizeButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                </svg>`;
                minimizeButton.title = 'Maximize Control Bar';
            } else {
                minimizeButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
                </svg>`;
                minimizeButton.title = 'Minimize Control Bar';
            }
        });

        saveNameButton.addEventListener('click', () => {
            const userName = nameInput.value.trim();
            if (userName) {
                localStorage.setItem('userName', userName);
                nameModalOverlay.style.display = 'none';
                updatePersonalGreeting();
            } else {
                nameInput.placeholder = "Please enter your name!";
            }
        });

        nameInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                saveNameButton.click();
            }
        });

        window.addEventListener('load', () => {
            const userName = localStorage.getItem('userName');
            if (!userName) {
                nameModalOverlay.style.display = 'flex';
                nameInput.focus();
            } else {
                updatePersonalGreeting();
            }
        });
    </script>
</body>
</html>
